############# Includes ############################
php_value include_path "includes"


############# Charset & Types ######################
AddDefaultCharset UTF-8
#AddCharset UTF-8 .php
#AddCharset UTF-8 .html

AddType application/vnd.ms-fontobject .eot
AddType application/x-font-ttf .ttf
AddType application/x-font-opentype .otf
AddType application/x-font-woff .woff
AddType image/svg+xml .svg
AddType application/octet-stream .zip


############# Compatibility#######################
<IfModule mod_setenvif.c>
  <IfModule mod_headers.c>
    BrowserMatch MSIE ie
    Header set X-UA-Compatible "IE=Edge,chrome=1" env=ie
  </IfModule>
</IfModule>


############# Security #############################
##### UAgents BList
<IfModule mod_setenvif.c>
	SetEnvIfNoCase User-Agent (\<|\>|\'|\$x0|\%0A|\%0D|\%27|\%3C|\%3E|\%00|\+select|\+union|\&lt) keep_out
	SetEnvIfNoCase User-Agent (binlar|casper|checkprivacy|cmsworldmap|comodo|curious|diavol|doco) keep_out
	SetEnvIfNoCase User-Agent (dotbot|feedfinder|flicky|ia_archiver|jakarta|kmccrew|libwww|nutch) keep_out
	SetEnvIfNoCase User-Agent (planetwork|purebot|pycurl|skygrid|sucker|turnit|vikspid|zmeu|zune) keep_out
	<limit GET POST PUT>
		Order Allow,Deny
		Allow from all
		Deny from env=keep_out
		# Deny from all
		# Deny from 111.222.333
	</limit>
</IfModule>


############# Rewrites ###########################
<IfModule mod_rewrite.c>

	Options +FollowSymLinks
	RewriteEngine On

	RewriteCond %{REQUEST_URI}::$1 ^(.*?/)(.*)::\2$
	RewriteRule ^(.*)$ - [E=BASE:%1]


	#### Hosts BList
	RewriteCond %{HTTP_HOST} (.*)\.crimea\.com [NC,OR]
	RewriteCond %{HTTP_HOST} s368\.loopia\.se [NC,OR]
	RewriteCond %{HTTP_HOST} kanagawa\.ocn [NC,OR]
	RewriteCond %{HTTP_HOST} g00g1e [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} (g00g1e|seekerspider|siclab|spam|sqlmap) [NC]
	RewriteRule .* - [F,L]


	#### Some joke
	Redirect 301 /wp-config.php http://www.fbi.gov/


	#### Maintenance Redirection
	#RewriteCond %{REQUEST_URI} !maintenance.html
	#RewriteCond %{REQUEST_FILENAME} !(styles|images).+$
	#RewriteCond %{REQUEST_URI} !/[style|js]/[^/]+
	#RewriteCond %{REMOTE_ADDR} !^80\.185\.62\.181$
	#RewriteCond %{REMOTE_ADDR} !^127\.0\.0\.1$
	#RewriteRule $ /maintenance.html [R=307,L]

	RewriteRule ^maintenance.html %{ENV:BASE} [R=301,L]


	####Security
	RewriteRule ^models/(.*)$ %{ENV:BASE}/index.php [R=403,NC,L]
	RewriteRule ^views/(.*)$ %{ENV:BASE}/index.php [R=403,NC,L]
	RewriteRule ^controllers/(.*)$ %{ENV:BASE}/index.php [R=403,NC,L]
	RewriteRule ^includes/(.*)$ %{ENV:BASE}/index.php [R=403,NC,L]


	#Specifics
	RewriteRule ^profil-editer/([^/]+) %{ENV:BASE}/index.php?requ=profil-editer&id=$1 [NC]
	RewriteRule ^profil/([^/]+) %{ENV:BASE}/index.php?requ=profil&id=$1 [NC]
	RewriteRule ^promotion/([^/]+) %{ENV:BASE}/index.php?requ=promotion&id=$1 [NC]
	RewriteRule ^evenement-editer/([^/]+) %{ENV:BASE}/index.php?requ=evenement-editer&id=$1 [NC]
	RewriteRule ^evenement-ajouter/([^/]+) %{ENV:BASE}/index.php?requ=evenement-ajouter [NC]
	RewriteRule ^evenement/([^/]+) %{ENV:BASE}/index.php?requ=evenement&id=$1 [NC]
	RewriteRule ^entreprise/([^/]+) %{ENV:BASE}/index.php?requ=entreprise&id=$1 [NC]
	RewriteRule ^diplome-editer/([^/]+) %{ENV:BASE}/index.php?requ=diplome-editer&id=$1 [NC]
	RewriteRule ^diplome/([^/]+) %{ENV:BASE}/index.php?requ=diplome&id=$1 [NC]
	RewriteRule ^etablissement-editer/([^/]+) %{ENV:BASE}/index.php?requ=etablissement-editer&id=$1 [NC]
	RewriteRule ^etablissement/([^/]+) %{ENV:BASE}/index.php?requ=etablissement&id=$1 [NC]



	#### Generals
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_URI} !helpers
	RewriteRule ^([A-Za-z0-9-]+)/?$ %{ENV:BASE}/index.php?requ=$1 [L]


	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteCond %{REQUEST_FILENAME}.php -f
	RewriteRule ^(.*)$ $1.php
</IfModule>